<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="SCE2.FolderExplorerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SCE2"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <UserControl.Resources>
        <MenuFlyout x:Key="FileContextMenu">
            <MenuFlyoutItem x:Name="OpenFileMenuItem" 
                            Text="Open" 
                            Click="OpenFileMenuItem_Click"/>
            <MenuFlyoutItem x:Name="OpenInNewTabMenuItem" 
                            Text="Open in New Tab" 
                            Click="OpenInNewTabMenuItem_Click"/>
            <MenuFlyoutSeparator/>
            <MenuFlyoutItem x:Name="RenameMenuItem" 
                            Text="Rename" 
                            Click="RenameMenuItem_Click"/>
            <MenuFlyoutItem x:Name="DeleteMenuItem" 
                            Text="Delete" 
                            Click="DeleteMenuItem_Click"/>
            <MenuFlyoutSeparator/>
            <MenuFlyoutItem x:Name="CopyPathMenuItem" 
                            Text="Copy Path" 
                            Click="CopyPathMenuItem_Click"/>
            <MenuFlyoutItem x:Name="OpenInExplorerMenuItem" 
                            Text="Open in File Explorer" 
                            Click="OpenInExplorerMenuItem_Click"/>
        </MenuFlyout>

        <DataTemplate x:Key="FileSystemItemTemplate" x:DataType="local:FileSystemItem">
            <StackPanel Orientation="Horizontal" Spacing="6">
                <Grid Width="16" Height="16">
                    <Image Source="{x:Bind IconInfo.Icon}" 
                           Width="13" Height="13" 
                           VerticalAlignment="Center"
                           Visibility="{x:Bind IconInfo.IsEmoji, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                    <TextBlock Text="{x:Bind IconInfo.Icon}" 
                               FontSize="12" 
                               VerticalAlignment="Center" 
                               HorizontalAlignment="Center"
                               Visibility="{x:Bind IconInfo.IsEmoji, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </Grid>
                <TextBlock Text="{x:Bind Name}" 
                           FontSize="12" 
                           VerticalAlignment="Center"
                           ToolTipService.ToolTip="{x:Bind FullPath}"/>
            </StackPanel>
        </DataTemplate>

        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Background="{ThemeResource SystemChromeLowColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" 
                Background="{ThemeResource SystemChromeBlackLowColor}"
                BorderThickness="0,0,0,1" 
                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                Padding="10,8">
            <Grid Height="25">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="FolderPathText" 
                           Grid.Column="0"
                           Text="No folder open" 
                           FontSize="12" 
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           ToolTipService.ToolTip="{x:Bind FolderPathText.Text, Mode=OneWay}"/>

                <Button x:Name="RefreshButton" 
                        Grid.Column="1"
                        Content="âŸ³" 
                        FontSize="15"
                        Width="26" Height="26"
                        Background="Transparent" 
                        BorderThickness="0"
                        Padding="0"
                        Margin="0"
                        CornerRadius="0"
                        ToolTipService.ToolTip="Refresh"
                        Click="RefreshButton_Click"/>
            </Grid>
        </Border>

        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Auto"
                      ZoomMode="Disabled">
            <TreeView x:Name="FileTreeView" 
                      Background="Transparent"
                      SelectionMode="Single"
                      ItemInvoked="FileTreeView_ItemInvoked"
                      PointerPressed="FileTreeView_PointerPressed">
                <TreeView.ItemTemplate>
                    <DataTemplate x:DataType="local:FileSystemItem">
                        <TreeViewItem ItemsSource="{x:Bind Children}" 
                                      IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                                      ContentTemplate="{StaticResource FileSystemItemTemplate}"/>
                    </DataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </ScrollViewer>
    </Grid>
</UserControl>